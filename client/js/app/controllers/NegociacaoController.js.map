{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_ordemAtual","_service","NegociacaoService","_init","event","preventDefault","novaNegociacao","_novaNegociacao","cadastra","then","adiciona","texto","_resetaForm","catch","erro","apaga","limpa","msg","coluna","inverteOrdem","ordena","a","b","lista","negociacoes","forEach","negociacao","setInterval","_importaNegociacoes","importa","results","Negociacao","DateHelper","textoParaData","value","parseInt","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController {\r\n\r\n    constructor() {\r\n        let $ = document.querySelector.bind(document);\r\n\r\n        this._inputData = $('#data');\r\n        this._inputQuantidade = $('#quantidade');\r\n        this._inputValor = $('#valor');\r\n\r\n        this._listaNegociacoes = new Bind(\r\n            new ListaNegociacoes(),\r\n            new NegociacoesView($('#negociacoesView')),\r\n            'adiciona', 'limpa', 'ordena', 'inverteOrdem');\r\n        this._mensagem = new Bind(\r\n            new Mensagem(),\r\n            new MensagemView($('#mensagemView')),\r\n            'texto');\r\n\r\n        this._ordemAtual = '';\r\n        this._service = new NegociacaoService();\r\n\r\n        this._init();\r\n    }\r\n\r\n    adiciona(event) {\r\n        event.preventDefault();\r\n\r\n        let novaNegociacao = this._novaNegociacao();\r\n        this._service\r\n            .cadastra(novaNegociacao)\r\n            .then(() => {\r\n                this._listaNegociacoes.adiciona(novaNegociacao);\r\n                this._mensagem.texto = \"Negociação adicionada com sucesso!\";\r\n                this._resetaForm();\r\n            })\r\n            .catch(erro => this._mensagem.texto = erro);\r\n    }\r\n\r\n    limpa() {\r\n        this._service\r\n            .apaga()\r\n            .then(msg => {\r\n                this._listaNegociacoes.limpa();\r\n                this._mensagem.texto = msg;\r\n            })\r\n            .catch(erro => this._mensagem.texto = erro);\r\n    }\r\n\r\n    ordena(coluna) {\r\n        if (this._ordemAtual === coluna) {\r\n            this._listaNegociacoes.inverteOrdem();\r\n        } else {\r\n            this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n        }\r\n        this._ordemAtual = coluna;\r\n    }\r\n\r\n    _init() {\r\n        this._service\r\n            .lista()\r\n            .then(negociacoes => negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao)))\r\n            .catch(erro => this._mensagem.texto = erro);\r\n\r\n        setInterval(() => this._importaNegociacoes(), 3000);\r\n    }\r\n\r\n    _importaNegociacoes() {\r\n        this._service.importa(this._listaNegociacoes.negociacoes)\r\n            .then(results => {\r\n                results.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\r\n                this._mensagem.texto = \"Negociações importadas com sucesso.\";\r\n            })\r\n            .catch(erro => this._mensagem.texto = erro);\r\n    }\r\n\r\n    _novaNegociacao() {\r\n        return new Negociacao(\r\n            DateHelper.textoParaData(this._inputData.value),\r\n            parseInt(this._inputQuantidade.value),\r\n            parseFloat(this._inputValor.value),\r\n        );\r\n    }\r\n\r\n    _resetaForm() {\r\n        this._inputData.value = '';\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0;\r\n\r\n        this._inputData.focus();\r\n    }\r\n}\r\n"]}